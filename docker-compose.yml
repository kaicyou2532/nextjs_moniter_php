services:
  nextjs-monitor:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: nextjs-monitor-php-new
    ports:
      - "8080:8080"   # PHP管理ツール（Apache）
      - "80:80"       # Next.jsアプリ（nginx）
      - "3000:3000"   # Next.js直接アクセス用（オプション）
    volumes:
      # ローカルマウント方式（パーミッション問題がある場合はコメントアウト）
      # - ./next-app:/var/www/html/next-app
      # - ./logs:/var/www/html/logs  
      # - ./pids:/var/www/html/pids
      
      # Docker volume方式（安定版）
      - nextjs-app-data:/var/www/html/next-app
      - logs-data:/var/www/html/logs
      - pids-data:/var/www/html/pids
    environment:
      - GITURL=https://github.com/AIM-SC/next-website.git
      - HOME=/root
      - NPM_CONFIG_CACHE=/tmp/.npm
      - TMPDIR=/tmp
      - TMP=/tmp
      - TEMP=/tmp
    restart: always
    working_dir: /var/www/html
    user: "0:0"
    privileged: true

# 名前付きボリューム
volumes:
  nextjs-app-data:
  logs-data:
  pids-data:
