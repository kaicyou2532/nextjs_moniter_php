services:
  nextjs-monitor:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: nextjs-monitor-php-new
    ports:
      - "8080:8080"   # PHP管理ツール（Apache）
      - "80:80"       # Next.jsアプリ（nginx）
      - "3000:3000"   # Next.js直接アクセス用（オプション）
    extra_hosts:
      - "host.docker.internal:host-gateway"  # Dockerホストへのアクセスを有効化
    volumes:

      - ./next-app:/var/www/html/next-app
      - logs-data:/var/www/html/logs
      - pids-data:/var/www/html/pids
      
      # 環境変数ファイルをマウント
      - ./.env:/var/www/html/.env:ro

      # PHP管理ファイルをバインドマウント（ホスト側を編集するだけで即反映、再ビルド不要）
      - ./public:/var/www/html/public
    environment:
      - GITURL=https://github.com/AIM-SC/next-website.git
      - HOME=/root
      - NPM_CONFIG_CACHE=/tmp/.npm
      - TMPDIR=/tmp
      - TMP=/tmp
      - TEMP=/tmp
    restart: always
    working_dir: /var/www/html
    user: "0:0"
    privileged: true

# 名前付きボリューム
volumes:
  logs-data:
  pids-data:
